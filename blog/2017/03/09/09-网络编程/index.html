<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>第九章 网络编程 | Hepsilion</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="author" content="Hepsilion">
    <meta name="email" content="2428091608@qq.com">
    <meta name="keywords" lang="zh-cn" content="博客, 计算机, Java">
    <meta name="description" content="Hepsilion的博客">

    
        <link rel="alternate" href="/" title="Hepsilion" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/blog/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/blog/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/blog/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/blog/css/style.css">

    <script src="/blog/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/blog/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/blog/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    
        <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?d08353c90accd3d0f9b4a0e8e62244ab";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Hepsilion</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/blog/home">Home</a>
                
                    <a class="main-nav-link" href="/blog/.">Content</a>
                
                    <a class="main-nav-link" href="/blog/archives">Archives</a>
                
                    <a class="main-nav-link" href="/blog/categories">Categories</a>
                
                    <a class="main-nav-link" href="/blog/tags">Tags</a>
                
                    <a class="main-nav-link" href="/blog/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/blog/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/blog/home">Home</a></td>
                
                    <td><a class="main-nav-link" href="/blog/.">Content</a></td>
                
                    <td><a class="main-nav-link" href="/blog/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/blog/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/blog/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/blog/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer" id="mybody">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/blog/css/images/avatar.png" />
            <h2 id="name">Hepsilion</h2>
            <h3 id="title">Software Engineer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Shanghai, China</span>
            <a id="follow" target="_blank" href="https://github.com/Hepsilion">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                41
                <span>文章</span>
            </div>
            <div class="article-info-block">
                21
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="/blog/" target="_blank" title="weixin" class=tooltip>
                            <i class="fa fa-weixin"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://weibo.com/u/2472060560" target="_blank" title="weibo" class=tooltip>
                            <i class="fa fa-weibo"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://www.facebook.com/profile.php?id=100011380133616" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/blog/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/blog/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-09-网络编程" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            第九章 网络编程
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/blog/2017/03/09/09-网络编程/">
            <time datetime="2017-03-09T12:46:32.000Z" itemprop="datePublished">2017-03-09</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/blog/categories/Android基础/">Android基础</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/blog/tags/Android/">Android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <ul>
<li>Http协议简介</li>
<li>使用Handler进行线程间通信</li>
<li>AsyncTask</li>
<li>使用HttpURLConnection、HttpClient访问网络提交数据</li>
<li>AsyncHttpClient、SmartImageView开源项目的使用</li>
<li>多线程下载文件</li>
</ul>
<a id="more"></a>
<p>Android系统提供了以下几种方式实现网络通信：Socket通信、HTTP通信、URL通信和WebView，其中最常用的是HTTP通信。</p>
<h2 id="一、网络编程入门"><a href="#一、网络编程入门" class="headerlink" title="一、网络编程入门"></a>一、网络编程入门</h2><h3 id="1-HTTP协议简介"><a href="#1-HTTP协议简介" class="headerlink" title="1. HTTP协议简介"></a>1. HTTP协议简介</h3><p>HTTP：超文本传输协议，它规定了浏览器和万维网服务器之间互相通信的规则。</p>
<blockquote>
<p>当客户端在与服务器端建立连接后，向服务器端发送的请求，被称作HTTP请求。服务器端接收到请求后会做出响应，称为HTTP响应。</p>
</blockquote>
<h3 id="2-Handler消息机制原理"><a href="#2-Handler消息机制原理" class="headerlink" title="2. Handler消息机制原理"></a>2. Handler消息机制原理</h3><p>在使用Android手机下载软件时，通常都能在界面上看到一个下载的进度条，这个进度条用来表示当前软件下载的进度。但是<strong>Android4.0以后不能在UI线程中访问网络，子线程也不能更新UI界面</strong>。为了根据下载进度实时更新UI界面，就需要用到Handler消息机制来实现线程间的通信。</p>
<p>Handler机制主要包括4个关键对象，分别是Message、Handler、MessageQueue和Looper。</p>
<p>(1) Message</p>
<p>Message是在线程之间传递的消息，它可以在内部携带少量的信息，用于在不同的线程之间交换数据。</p>
<p>Message的what字段可以用来携带一些整型数据，obj字段可以用来携带一个Object对象。</p>
<p>(2) Handler</p>
<p>Handler主要用于发送消息和处理消息。</p>
<p>一般使用Handler对象的sendMessage()方法发送消息，发出的消息经过一系列的辗转处理后，最终会传递到Handler对象的handleMessage()方法中。</p>
<p>(3) MessageQueue</p>
<p>MessageQueue主要用来存放通过Handler发送的消息。通过Handler发送的消息会存在Message中等待处理。</p>
<p>每个线程中只会有一个MessageQueue对象。</p>
<p>(4) Looper</p>
<p>Looper是每个线程中的MessageQueue的管家。调用Looper的loop()方法后，就会进入一个无限循环中。然后，每当发现MessageQueue中存在一条消息，就会将它取出，并传递到Handler的handleMessage()方法中。</p>
<p>此外，<strong>每个线程也只有一个Looper对象</strong>。在主线程中创建Handler对象时，系统已经创建了Looper对象，所以不用手动创建Looper对象，而在子线程中的Handler对象，需要调用Looper.loop()方法开启消息循环。</p>
<center><br><img src="/blog/2017/03/09/09-网络编程/Pic9-1.JPG" width="60%">图 9-1<br></center>

<p><strong>Handler消息机制处理流程</strong>如图9-1所示：</p>
<ul>
<li><p>在主线程(UI线程)创建一个Handler对象</p>
</li>
<li><p>在子线程中调用Handler的sendMessage()方法发送消息</p>
</li>
<li><p>这个消息会存放在主线程的MessageQueue中，通过Looper对象取出MessageQueue中的消息，最后分发回Handler的handleMessage()方法中进行处理，更新UI。</p>
</li>
</ul>
<h3 id="3-AsyncTask"><a href="#3-AsyncTask" class="headerlink" title="3. AsyncTask"></a>3. AsyncTask</h3><p>为了方便在子线程中对UI进行操作，Android提供了一些好用的工具类，AsyncTask就是其中之一。利用AsyncTask，可以十分简单地从子线程切换到主线程，它的原理是基于异步消息处理机制实现的。</p>
<p>AsyncTask是一个抽象类，使用它必须创建一个类继承它。在继承AsyncTask时，可以为其执行三个泛型参数，这三个参数的用途如下：</p>
<ul>
<li>Params：在执行AsyncTask时需要传入的参数，用于后台任务中使用。</li>
<li>Progress：后台任务执行时，如果需要在界面上显示当前的进度，则使用该参数作为进度单位。</li>
<li>Result:当任务执行完毕后，如果需要对结果进行返回，则使用该参数作为返回值类型。</li>
</ul>
<p>下面定义了一个AsyncTask类，它的三个泛型参数分别被指定为Void, Integer, Boolean。第一个参数表示在执行AsyncTask时，不需要传递参数给后台任务；第个参数表示使用整数来作为进度显示单位；第三个参数表示使用布尔值来返回执行结果。</p>
<p>通常在使用AsyncTask时，需要重写它的4个方法：</p>
<pre><code>public class MyAsyncTask extends AsyncTask&lt;Void, Integer, Boolean&gt; {
    // 这个方法在后台任务执行之前调用，一般用于界面上的初始化操作，例如，显示一个进度条对话框
    @Override
    protected void onPreExecute() {
        super.onPreExecute();
    }

    //这个方法在子线程中运行，用于处理耗时操作，操作一旦完成即可以通过return语句将任务的执行结果返回。
    //如果AsyncTask的第三个泛型参数指定的是void，则可以不返回执行结果。
    //注意：这个方法不能进行更新UI操作，如果要在该方法中更新UI，可以调用publishProgress()方法来完成。
    @Override
    protected Boolean doInBackground(Void... params) {
        publishProgress(50);
        return null;
    }

    //如果在doInBackground()方法中调用了publishProgress()方法，这个方法就会很快被调用，方法中携带的参数就是后台任务传递过来的。
    //在这个方法中可以对UI进行操作，利用参数values就可以对UI进行相应的更新。
    @Override
    protected void onProgressUpdate(Integer... values) {
        super.onProgressUpdate(values);
    }

    //当doInBackground()方法执行完毕并且通过return语句返回时，这个方法会很快被调用。在doInBackground()中返回的数据会作为参数传递到该方法中。
    //此时可以利用返回的参数进行UI操作，例如，提醒某个任务完成了。
    @Override
    protected void onPostExecute(Boolean aBoolean) {
        super.onPostExecute(aBoolean);
    }
}
</code></pre><p>最后，我们可以在UI线程中创建AsyncTask实例，并调用它的execute()方法。</p>
<pre><code>new MyAsyncTask().execute();
</code></pre><p>以上便士AsyncTask的基本用法，使用AsyncTask可以不使用Handler发送和接收消息，只需要在doInBackground()方法中调用publicProgress()方法，即可实现从子线程切换到UI线程。</p>
<h2 id="二、HttpURLConnection和HttpClient"><a href="#二、HttpURLConnection和HttpClient" class="headerlink" title="二、HttpURLConnection和HttpClient"></a>二、HttpURLConnection和HttpClient</h2><p>在实际开发中，绝大多数App都需要和服务器进行数据交互，也就是访问网络。</p>
<p>Android客户端访问网络发送HTTP请求的方式一般有两种：HttpURLConnection和HttpClient。</p>
<p>HttpURLConnection是一个标准的Java类，HttpClient是一个开源项目。</p>
<h3 id="1-使用HttpURLConnection访问网络"><a href="#1-使用HttpURLConnection访问网络" class="headerlink" title="1. 使用HttpURLConnection访问网络"></a>1. 使用HttpURLConnection访问网络</h3><p>使用HttpURLConnection，客户端与服务器建立连接并获取服务器返回的数据的过程：</p>
<pre><code>try{
    //在URL的构造方法中传入要访问资源的路径
    URL url=new URL(&quot;https://www.baidu.com/&quot;);
    HttpURLConnection conn=(HttpURLConnection)url.openConnection();
    conn.setRequestMethod(&quot;GET&quot;);         //设置请求方式
    conn.setConnectionTimeout(5000);      //设置超时时间
    int code=conn.getResponseCode();
    if(code==200){  //请求网络成功后返回码是200
        InputStream is=conn.getInputStream(); //获取服务器返回的输入流
        //读取流信息，获取服务器返回的数据

        conn.disconnect(); //关闭http连接
    }else{ //返回码不是200，请求服务器失败
    }
}catch(Exception e){
}
</code></pre><p>需要注意的是，在使用HttpURLConnection对象访问网络时，需要设置超时时间。如果没有设置超时时间，在网络异常的情况下，程序会因取不到数据而一直等待，导致程序僵死不往下执行。</p>
<p><strong>案例：Demo0901，网络图片浏览器，演示手机端使用HttpURLConnection和客户端进行通信的过程</strong></p>
<h3 id="2-使用HttpClient访问网络"><a href="#2-使用HttpClient访问网络" class="headerlink" title="2. 使用HttpClient访问网络"></a>2. 使用HttpClient访问网络</h3><p>HttpClient是Apache的一个开源项目，从一开始就被引入到Android的API中。HttpClient可以完成和HttpURLConnection一样的效果，但使用起来更简单。简单来说，HttpClient是HttpURLConnection的增强版。</p>
<p>图9-2是使用HttpClient访问网络时所需要用到的几个常用类的介绍。</p>
<center><br><img src="/blog/2017/03/09/09-网络编程/Pic9-2.JPG" width="55%">图 9-2<br></center>

<p>使用HttpClient访问网络与HttpURLConnection的过程大致相同，具体步骤如下：</p>
<ul>
<li>创建HttpClient对象</li>
<li>指定访问网络的方式，创建一个HttpPost对象或者HttpGet对象 </li>
<li>如果需要发送请求参数，可调用HttpGet、HttpPost的setParams方法，对于HttpPost对象而言，也可以调用setEntity()方法来设置请求参数</li>
<li>调用HttpClient对象的execute()方法访问网络，并获取HttpResponse对象 </li>
<li>调用HttpResponse.getEntity()方法获取HttpEntity对象，该对象包装了服务器的响应内容，即所请求的数据。</li>
</ul>
<p>使用HttpClient访问服务器并获取返回数据的<strong>示例代码</strong>：</p>
<pre><code>HttpClient client=new DefaultHttpClient();
HttpPost httpPost=new HttpPost(&quot;https://www.baidu.com/&quot;);

List&lt;NameValuePair&gt; params=new ArrayList&lt;NameValuePair&gt;(); //创建一个NameValuePair集合，用于添加参数
params.add(new BasicNameValuePair(&quot;username&quot;, &quot;admin&quot;));
UrlEncodedFormEntity entity=new UrlEncodedFormEntity(params, &quot;utf-8&quot;); //给参数设置编码
httpPost.setEntity(entity);//设置参数

HttpResponse httpResponse=client.execute(httpPost);
int statusCode=httpResponse.getStatusLine().getStatusCode();
if(statusCode==200){
    HttpEntity httpEntity=httpResponse.getEntity();//获取HttpEntity实例
    String response=EntityUtils.toString(httpEntity, &quot;utf-8&quot;);//设置编码格式
    InputStream content = httpEntity.getContent();  //拿到输入流
}
</code></pre><p>需要注意的是，使用Post方式设置参数时，需要创建一个NameValuePair的集合来添加参数。在给参数设置编码时，需要与服务器的解码格式保持一致，否则会出现中文乱码的情况。</p>
<p><strong>案例：Demo0902，网络图片浏览器，，演示手机端使用HttpClient和客户端进行通信的过程</strong></p>
<h3 id="3-数据提交方式"><a href="#3-数据提交方式" class="headerlink" title="3. 数据提交方式"></a>3. 数据提交方式</h3><p>HTTP/1.1协议中共定义了8种方法来表明Request-URI指定的资源的不同的操作方式，其中最常用的两种请求方式是GET和POST。</p>
<p>(1) <strong>GET方式</strong></p>
<p>GET方式是以实体的方式得到由请求URL所指向的资源信息，它向服务器提交的参数跟在请求URL后面。</p>
<p>使用GET方式访问网络URL的长度是有限制的，HTTP协议规范规定GET方式请求URL的长度不超过4K。但是IE浏览器GET方式请求URL的长度不能超过1K。</p>
<p><strong>示例代码：</strong>使用HttpURLConnection GET方式提交数据到服务器：</p>
<pre><code>//将用户名和密码拼装在指定资源路径后面，并给用户名和密码进行编码
String path=&quot;http://192.168.1.100:8080/web/LoginServlet?username=&quot;
        +URLEncoder.encode(&quot;zhangsan&quot;)+&quot;&amp;password=&quot;+URLEncoder.encode(&quot;123&quot;);
URL url=new URL(path);
HttpURLConnection conn=url.openConnection();
conn.setRequestMethod(&quot;GET&quot;);             //设置请求方式
conn.setConnectTimeout(5000);             //设置超时时间
int responseCode=conn.getResponseCode();  //获取状态码
if(responseCode==200){//访问成功
    InputStream is=conn.getInputStream(); //获取服务器返回的输入流
    try{
        //读取流里面的信息
    }catch(Exception e){
    }
}
</code></pre><p>(2) <strong>POST方式</strong></p>
<p>POST方式在向服务器发出请求时，它向服务器提交的参数跟在请求实体中。</p>
<p>它提交的参数是浏览器通过流的方式直接写给服务器的，用户不能在浏览器中看到向服务器提交的请求参数，因此POST方式比GET方式相对安全。</p>
<p>此外，POST方式对URL的长度没有限制。</p>
<p><strong>示例代码：</strong>使用HttpURLConnection POST方式提交数据到服务器：</p>
<pre><code>//使用HttpURLConnection
String path=&quot;http://192.168.1.100:8080/web/LoginServlet&quot;;
//准备数据并给参数进行编码
String data=&quot;username=&quot;+URLEncoder.encode(&quot;zhangsan&quot;)+&quot;&amp;password=&quot;+URLEncoder.encode(&quot;123&quot;);

URL url=new URL(path);
HttpURLConnection conn=(HttpURLConnection)url.openConnection();
conn.setRequestMethod(&quot;POST&quot;);            //设置请求方式
conn.setConnectTimeout(5000);             //设置超时时间
//设置请求头-数据提交方式，这里是以form表单方式提交
conn.setRequestProperty(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
//设置请求头-设置提交数据的长度
conn.setRequestProperty(&quot;Content-Length&quot;, data.length()+&quot;&quot;);

//post方式，实际上是浏览器把数据写给了服务器
conn.setDoOutput(true);                  //设置允许向外写数据
OutputStream os=conn.getOutputStream();  
os.write(data.getBytes());               //利用输出流往服务器写数据

int code=conn.getResponseCode();          //获取状态码
if(responseCode==200){                    //访问成功
    InputStream is=conn.getInputStream(); //获取服务器返回的输入流
    try{
        //读取流里面的信息
    }catch(Exception e){
    }
}
</code></pre><p>注意：使用HttpURLConnection POST方式提交数据时，是以流的方式直接将参数写到服务器上的，需要设置数据的提交方式和数据的长度。</p>
<blockquote>
<p>在实际开发中，手机端和服务器进行交互的过程中，避免不了提交中文到服务器，这时就会出现中文乱码的情况。</p>
<p>无论是GET方式还是POST方式，提交参数时都要给参数进行编码。需要注意的是，编码方式必须与服务器解码方式统一。同样在获取服务器返回的中文数据时，也需要用指定格式进行解码。</p>
</blockquote>
<p><strong>案例：Demo0903和Demo0903Server：提交数据到服务器，演示HttpURLConnection/HttpClient分别使用Get方式和Post方式提交数据到服务器</strong></p>
<h2 id="三、开源项目"><a href="#三、开源项目" class="headerlink" title="三、开源项目"></a>三、开源项目</h2><p>在实际开发中，使用Android自带的API与服务器通信比较麻烦。一些热心的开发者为了节约开发成本、节约开发时间，开发出了一些开源的项目方便大家使用。因此网上出现了各种各样的开源项目。</p>
<p><strong>1. AsyncHttpClient</strong></p>
<p>由于访问网络是一个耗时的操作，放在主线程里面会影响用户体验，因此Google规定Android 4.0以后访问网络的操作都必须放在子线程中。</p>
<p>但是，在Android中，发送、处理HTTP请求十分常见，如果每次和服务器进行交互都需要开启一个子线程，这样是非常麻烦的。为了解决这个问题，一些开发者开发出了一个开源项目：AsyncHttpClient，它是HttpClient的再次包装。</p>
<p>AsyncHttpClient的特点有：发送异步HTTP请求，HTTP请求发生在UI线程之外，内部采用了线程池来处理并发请求。</p>
<p>AsyncHttpClient的常用类：</p>
<ul>
<li>AsyncHttpClient：用来访问网络的类</li>
<li>RequestParams:用来添加参数的类</li>
<li>AsyncHttpResponseHandler：访问网络后的回调接口</li>
</ul>
<p>使用AsyncHttpClient：创建AsyncHttpClient的实例；设置参数；通过AsyncHttpClient的实例对象访问网络。如果访问成功则会回调AsyncHttpResponseHandler接口中的OnSucess()方法；失败则会回调OnFailure()方法。</p>
<p>使用<strong>AsyncHttpClient的GET方式</strong>访问网络并提交数据实例代码：</p>
<pre><code>//拼接URL，注意将参数编码
String path=&quot;http://192.168.1.100:8080/web/LoginServlet?username=&quot;+URLEncoder.encode(&quot;zhang&quot;)+&quot;&amp;password=&quot;+URLEncoder.encode(&quot;123&quot;);

//创建AsyncHttpClient实例
AsyncHttpClient asyncHttpClient = new AsyncHttpClient();
//使用GET方式请求
asyncHttpClient.get(path, new AsyncHttpResponseHandler() {
    //请求成功
    public void onSuccess(String content) {
        super.onSuccess(content);
        Toast.makeText(MainActivity.this, &quot;请求成功&quot;+content, Toast.LENGTH_SHORT).show();
    }
    //请求失败
    public void onFailure(Throwable error, String content) {
        super.onFailure(error, content);
        Toast.makeText(MainActivity.this, &quot;请求失败&quot;+content, Toast.LENGTH_SHORT).show();
    }
});
</code></pre><p>使用<strong>AsyncHttpClient的POST方式</strong>访问网络并提交数据实例代码：</p>
<pre><code>String path=&quot;http://192.168.1.100:8080/web/LoginServlet&quot;;
//添加参数
RequestParams params=new RequestParams();
params.put(&quot;username&quot;, &quot;zhang&quot;);
params.put(&quot;password&quot;, &quot;123&quot;);

//创建AsyncHttpClient实例
AsyncHttpClient asyncHttpClient = new AsyncHttpClient();
//使用GET方式请求
asyncHttpClient.post(&quot;&quot;, new RequestParams(), new AsyncHttpResponseHandler(){
    //请求成功
    @Override
    public void onSuccess(int statusCode, Header[] headers, byte[] responseBody) {
        super.onSuccess(statusCode, headers, responseBody);
        Toast.makeText(MainActivity.this, &quot;请求成功&quot;+new String(responseBody), Toast.LENGTH_SHORT).show();
    }
    //请求失败
    @Override
    public void onFailure(int statusCode, Header[] headers, byte[] responseBody, Throwable error) {
        super.onFailure(statusCode, headers, responseBody, error);
        Toast.makeText(MainActivity.this, &quot;请求失败&quot;+new String(responseBody), Toast.LENGTH_SHORT).show();
    }
});
</code></pre><p>从上面的实例代码可以看出，使用AsyncHttpClient访问网络并不需要创建子线程，而且不需要切换线程更新UI，使用起来更加方便。</p>
<p><strong>2. SmartImageView</strong></p>
<p>应用市场上的常见软件都加载了大量的网络上的图片。如果使用Android自带的API实现这一功能，首先需要请求网络，然后获取服务器返回的图片信息，转换成输入流，使用BitmapFactory生成Bitmap对象，最后再设置到指定的控件中，这种操作步骤十分麻烦而且耗时。为了，开发者们开发了一个开源项目：SmartImageView。它继承自ImageView，支持根据URL地址加载图片、支持异步加载图片、支持图片缓存等。</p>
<p>使用SmartImageView加载网络图片的实例代码：</p>
<p>(1) 在布局文件中添加SmartImageView控件</p>
<pre><code>&lt;com.loopj.android.image.SmartImageView
    android:id=&quot;@+id/siv_icon&quot;
    android:layout_width=&quot;80dip&quot;
    android:layout_height=&quot;60dip&quot;
    android:layout_alignParentLeft=&quot;true&quot;
    android:layout_marginBottom=&quot;5dip&quot;
    android:layout_marginLeft=&quot;5dip&quot;
    android:layout_marginTop=&quot;5dip&quot;
    android:scaleType=&quot;centerCrop&quot;
    android:src=&quot;@drawable/ic_launcher&quot; /&gt;
</code></pre><p>(2) 在Activity中使用SmartImageView控件</p>
<pre><code>SmartImageView siv = (SmartImageView) view.findViewById(R.id.siv_icon);
//SmartImageView加载指定路径图片
siv.setImageUrl(newsInfo.getIconPath(), R.drawable.ic_launcher, R.drawable.ic_launcher);
</code></pre><p>在加载指定图片时，setImageUrl()方法指定了图片的路径，加载中显示的图片以及加载失败时显示的图片。</p>
<p><strong>案例：Demo0904，新闻客户端，演示AsyncHttpClient和SmartImageView的综合使用，该案例使用AsyncHttpClient实现获取服务器的XML文件并将其解析出来捆绑显示到ListView上，然后使用SmartImageView获取网络图片</strong></p>
<h2 id="四、多线程下载"><a href="#四、多线程下载" class="headerlink" title="四、多线程下载"></a>四、多线程下载</h2><p>下载一个文件时，使用多线程下载速度通常比使用单线程下载速度快。</p>
<p>使用多线程下载资源时，先要获取到服务器资源文件的大小，然后在本地创建一个与服务器资源一样大的文件，接着在客户端开启若干个线程去下载服务器资源。<strong>需要注意的是，每个线程必须要下载对应的模块，然后将每个线程下载的模块按顺序组装成资源文件。</strong></p>
<center><br><img src="/blog/2017/03/09/09-网络编程/Pic9-3.JPG" width="60%">图 9-3<br></center>

<p>图9-3展示了多线程下载的原理：从图中可以看出，每个线程下载的区域就是总大小/线程个数，但不能保证每个文件都可以完全平均分配资源，因此最后一个线程需要下载到文件的末尾。</p>
<p><strong>需要注意的是，使用多线程下载时，需要在请求头中设置Range字段获取到指定位置的数据，例如Range:byte=100-200</strong></p>
<p><strong>案例：Demo0905，多线程下载文件，并将每个线程的下载进度显示在界面上</strong></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="https://hepsilion.github.io/2017/03/09/09-网络编程/" data-id="cj5jojvl8001q1wwrub9eii9e" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="https://hepsilion.github.io/2017/03/09/09-网络编程/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="https://hepsilion.github.io/2017/03/09/09-网络编程/">评论</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/blog/2017/03/08/08-Service/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    第八章 服务
                
            </div>
        </a>
    
    
        <a href="/blog/2017/03/15/数据结构/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">数据结构</div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

</section>
            
                <aside id="sidebar">
   <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/blog/',
        CONTENT_URL: '/blog/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/blog/js/insight.js"></script>

</div> 
   
        
    <div class="widget-wrap">
        <h3 class="widget-title"><i class="fa fa-edit"></i>最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2017/07/23/IT校招全国统一模拟笔试-秋招备战专场二模-编程题/" class="thumbnail">
    
    
        <span style="background-image:url(https://wx2.sinaimg.cn/small/e3dde130ly1fft6ucav3vj20zk0iyq5v.jpg)" alt="IT校招全国统一模拟笔试(秋招备战专场二模)编程题" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/blog/categories/动态规划/">动态规划</a></p>
                            <p class="item-title"><a href="/blog/2017/07/23/IT校招全国统一模拟笔试-秋招备战专场二模-编程题/" class="title">IT校招全国统一模拟笔试(秋招备战专场二模)编程题</a></p>
                            <p class="item-date"><time datetime="2017-07-23T13:11:16.000Z" itemprop="datePublished">2017-07-23</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2017/06/06/MapReduce/" class="thumbnail">
    
    
        <span style="background-image:url(https://wx2.sinaimg.cn/small/e3dde130ly1fft6ucav3vj20zk0iyq5v.jpg)" alt="MapReduce" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/blog/2017/06/06/MapReduce/" class="title">MapReduce</a></p>
                            <p class="item-date"><time datetime="2017-06-06T14:06:35.000Z" itemprop="datePublished">2017-06-06</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2017/05/28/Docker-Hadoop-Helloworld/" class="thumbnail">
    
    
        <span style="background-image:url(https://wx2.sinaimg.cn/small/e3dde130ly1fft6ucav3vj20zk0iyq5v.jpg)" alt="Docker-Hadoop-Helloworld" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/blog/categories/环境配置/">环境配置</a></p>
                            <p class="item-title"><a href="/blog/2017/05/28/Docker-Hadoop-Helloworld/" class="title">Docker-Hadoop-Helloworld</a></p>
                            <p class="item-date"><time datetime="2017-05-28T14:48:12.000Z" itemprop="datePublished">2017-05-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2017/05/28/C-plus-plus/" class="thumbnail">
    
    
        <span style="background-image:url(https://wx2.sinaimg.cn/small/e3dde130ly1fft6ucav3vj20zk0iyq5v.jpg)" alt="C plus plus" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/blog/categories/C-C/">C/C++</a></p>
                            <p class="item-title"><a href="/blog/2017/05/28/C-plus-plus/" class="title">C plus plus</a></p>
                            <p class="item-date"><time datetime="2017-05-28T11:03:50.000Z" itemprop="datePublished">2017-05-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/blog/2017/05/28/Probability-Theory/" class="thumbnail">
    
    
        <span style="background-image:url(https://wx2.sinaimg.cn/small/e3dde130ly1fft6ucav3vj20zk0iyq5v.jpg)" alt="Probability Theory" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/blog/categories/概率论与数理统计/">概率论与数理统计</a></p>
                            <p class="item-title"><a href="/blog/2017/05/28/Probability-Theory/" class="title">Probability Theory</a></p>
                            <p class="item-date"><time datetime="2017-05-28T11:02:06.000Z" itemprop="datePublished">2017-05-28</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title"><i class="fa fa-folder"></i>分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Android基础/">Android基础</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/C-C/">C/C++</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Java-Web/">Java Web</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Java基础/">Java基础</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/动态规划/">动态规划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/并发/">并发</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/概率论与数理统计/">概率论与数理统计</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/环境配置/">环境配置</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/算法/">算法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/计算机基础/">计算机基础</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/设计模式/">设计模式</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title"><i class="fa fa-archive"></i>归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/06/">六月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/05/">五月 2017</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/03/">三月 2017</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/02/">二月 2017</a><span class="archive-list-count">12</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title"><i class="fa fa-tag"></i>标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Android/">Android</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/C/">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Java/">Java</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/SQL/">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Web/">Web</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/docker/">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/hadoop/">hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/信息安全/">信息安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/并发/">并发</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/操作系统/">操作系统</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/数据库/">数据库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/数据结构/">数据结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/数理统计/">数理统计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/概率论/">概率论</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/算法/">算法</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/计算机组成原理/">计算机组成原理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/计算机网络/">计算机网络</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/软件工程/">软件工程</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/软件测试/">软件测试</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title"><i class="fa fa-link"></i>友链</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io" target="_blank">Hexo</a>
                    </li>
                
                    <li>
                        <a href="http://yuren.space/blog" target="_blank">渔人</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 Hepsilion<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'https://hepsilion.github.io/2017/03/09/09-网络编程/';
        
        this.page.identifier = '09-网络编程';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'hepsilion-github-io' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>




    
        <script src="/blog/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/blog/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/blog/js/main.js"></script>

    </div>
</body>
</html>